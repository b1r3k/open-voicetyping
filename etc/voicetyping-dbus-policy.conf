<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-Bus Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <!-- Allow voicetyping user to own and manage keyboard service -->
  <policy user="voicetyping">
    <allow send_destination="org.gnome.Shell"/>
    <allow send_destination="org.gnome.Shell.Extensions"/>
    <allow send_destination="org.gnome.Shell.Extensions.VoiceTyping"/>
    <allow send_destination="org.freedesktop.DBus"/>
    <allow send_destination="org.freedesktop.DBus.Introspectable"/>
    <!-- Allow voicetyping user to own the keyboard service -->
    <allow own="com.cxlab.VirtualKeyboard"/>
    <allow own_prefix="com.cxlab"/>
  </policy>

  <!-- Allow session user (lukasz) to own and manage main service and communicate with keyboard service -->
  <policy user="lukasz">
    <!-- Allow owning the main voicetyping service -->
    <allow own="com.cxlab.VoiceTyping"/>
    <allow own_prefix="com.cxlab"/>

    <!-- Allow sending messages to the keyboard service (run by voicetyping user) -->
    <allow send_destination="com.cxlab.VirtualKeyboard"/>
    <allow send_interface="com.cxlab.VirtualKeyboardInterface"/>

    <!-- Allow receiving messages from GNOME shell extension -->
    <allow receive_sender="org.gnome.Shell"/>
    <allow receive_interface="org.gnome.Shell.Extensions.VoiceTyping"/>
  </policy>

  <!-- Allow GNOME shell to send messages to the main voicetyping service -->
  <policy user="lukasz">
    <allow send_destination="com.cxlab.VoiceTyping"/>
    <allow send_interface="com.cxlab.VoiceTypingInterface"/>
  </policy>

  <!-- Allow any user to send messages to both services (for debugging/testing) -->
  <policy context="default">
    <allow send_destination="com.cxlab.VoiceTyping"/>
    <allow send_destination="com.cxlab.VirtualKeyboard"/>
    <allow receive_sender="com.cxlab.VoiceTyping"/>
    <allow receive_sender="com.cxlab.VirtualKeyboard"/>
  </policy>
</busconfig>
